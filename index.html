<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Medieval Kingdom Simulator AI War</title>
<style>
body{margin:0;font-family:Arial;background:#020617;color:#e5e7eb;}
.top{display:flex;flex-wrap:wrap;gap:6px;padding:8px;background:#020617;font-size:13px;}
.top span{background:#1e293b;padding:4px 6px;border-radius:6px;}
.panel{display:none;padding:10px;overflow-y:auto;max-height:70vh;}
.active{display:block;}
button,input,select{padding:8px;border-radius:6px;border:none;margin:4px;cursor:pointer;}
button{background:#2563eb;color:#fff;}
input,select{width:80px;}
.box{background:#1e293b;padding:8px;border-radius:8px;margin:6px 0;}
.menu{position:fixed;bottom:0;width:100%;background:#020617;display:flex;flex-wrap:wrap;justify-content:space-around;}
</style>
</head>
<body>

<div class="top">
<span>ğŸ’° <b id="gold"></b></span>
<span>ğŸ <b id="food"></b></span>
<span>ğŸ‘¥ <b id="pop"></b></span>
<span>âš” <b id="army"></b></span>
<span>ğŸ˜Š <b id="stab"></b>%</span>
<span>ğŸ“… <b id="year"></b></span>
</div>

<!-- Start Selection Panel -->
<div id="startP" class="panel active">
<h2>ğŸ° Select Your Kingdom</h2>
<select id="kingdomSelect"></select>
<button onclick="startGame()">Start Game</button>
</div>

<!-- Panels -->
<div id="home" class="panel">
<h2>ğŸ° Medieval Kingdom Simulator</h2>
<button onclick="openP('armyP')">Army</button>
<button onclick="openP('productionP')">Production</button>
<button onclick="openP('tradeP')">Trade</button>
<button onclick="openP('councilP')">Council</button>
<button onclick="openP('attackP')">Attack</button>
<button onclick="openP('statusP')">AI Status</button>
<button onclick="endTurn()">End Turn</button>
<button onclick="saveGame()">ğŸ’¾ Save Game</button>
<button onclick="loadGame()">ğŸ“‚ Load Game</button>
</div>

<div id="armyP" class="panel">
<h3>âš” Army Management</h3>
<div class="box">
Recruit Infantry: <input type="number" id="recInf" value="50">
<button onclick="recruit('infantry')">Recruit</button>
</div>
<div class="box">
Recruit Cavalry: <input type="number" id="recCav" value="20">
<button onclick="recruit('cavalry')">Recruit</button>
</div>
<div class="box">
Recruit Archer: <input type="number" id="recArc" value="30">
<button onclick="recruit('archer')">Recruit</button>
</div>
<p>Generals: <b id="gen"></b></p>
<p>Units: <b id="units"></b></p>
</div>

<div id="productionP" class="panel">
<h3>ğŸ­ Production</h3>
<div class="box">
Farm: <input type="number" id="farmNum" value="2"> <button onclick="setProd('farm')">Set</button>
</div>
<div class="box">
Factory: <input type="number" id="facNum" value="1"> <button onclick="setProd('factory')">Set</button>
</div>
</div>

<div id="tradeP" class="panel">
<h3>ğŸ¤ Trade</h3>
<button onclick="sellFood()">Sell 100 Food â†’ +80 Gold</button>
<button onclick="buyFood()">Buy 100 Food â†’ -90 Gold</button>
</div>

<div id="councilP" class="panel">
<h3>ğŸ› Council & Laws</h3>
<div class="box">
Tax Rate: <input type="number" id="tax" value="10"> % <button onclick="applyTax()">Apply</button>
</div>
<div class="box">
<button onclick="law('tax')">High Tax</button>
<button onclick="law('growth')">Population Growth</button>
<button onclick="law('military')">Military Focus</button>
<button onclick="law('trade')">Trade Focus</button>
</div>
</div>

<div id="attackP" class="panel">
<h3>âš” Attack Other Kingdoms</h3>
<select id="targetSelect"></select>
<div class="box">
Send Infantry: <input type="number" id="atkInf" value="0">
Send Cavalry: <input type="number" id="atkCav" value="0">
Send Archer: <input type="number" id="atkArc" value="0">
<button onclick="attack()">Attack!</button>
</div>
</div>

<div id="statusP" class="panel">
<h3>ğŸ“Š AI Kingdoms Status</h3>
<div id="aiStatus"></div>
</div>

<div class="menu">
<button onclick="openP('home')">Home</button>
<button onclick="openP('armyP')">Army</button>
<button onclick="openP('productionP')">Production</button>
<button onclick="openP('tradeP')">Trade</button>
<button onclick="openP('councilP')">Council</button>
<button onclick="openP('attackP')">Attack</button>
<button onclick="openP('statusP')">AI Status</button>
<button onclick="endTurn()">End Turn</button>
</div>

<script>
// ===== GAME STATE =====
let kingdoms=[];
let player=null;
let game={gold:600,food:500,pop:1600,stab:70,year:1400,units:{infantry:200,cavalry:50,archer:50},generals:1,production:{farm:2,factory:1}};

// ===== INITIALIZE 28 KINGDOMS =====
function initKingdoms(){
const names=["England","France","HRE","Castile","Portugal","Aragon","Naples","Poland","Lithuania","Hungary","Bohemia","Denmark","Sweden","Norway","Russia","Ottoman","Venice","Milan","Florence","Saxony","Bavaria","Brandenburg","Scotland","Ireland","Wales","Burgundy","Austria","Byzantium"];
kingdoms=[];
names.forEach((n,i)=>{
kingdoms.push({name:n,population:1000+Math.floor(Math.random()*1000),units:{infantry:100+Math.floor(Math.random()*100),cavalry:50+Math.floor(Math.random()*50),archer:50+Math.floor(Math.random()*50)},generals:1,production:{farm:2,factory:1},owner:false});
});
}

// ===== START GAME =====
function startGame(){
let sel=document.getElementById("kingdomSelect").value;
player=kingdoms[sel];
player.owner=true;
game.units={...player.units};
game.generals=player.generals;
game.production={...player.production};
openP('home');
updateTargets();
render();
}

// ===== PANEL MANAGEMENT =====
function openP(id){document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));document.getElementById(id).classList.add("active");render();}

// ===== RENDER =====
function render(){
document.getElementById("gold").innerText=game.gold;
document.getElementById("food").innerText=game.food;
document.getElementById("pop").innerText=game.pop;
let totalArmy=game.units.infantry+game.units.cavalry+game.units.archer;
document.getElementById("army").innerText=totalArmy;
document.getElementById("stab").innerText=game.stab;
document.getElementById("year").innerText=game.year;
document.getElementById("gen").innerText=game.generals;
document.getElementById("units").innerText=`Infantry: ${game.units.infantry}, Cavalry: ${game.units.cavalry}, Archer: ${game.units.archer}`;

let statusHTML="";
kingdoms.forEach(k=>{statusHTML+=`<p>${k.name} - Owner: ${k.owner?'Player':'AI'} - Units: I:${k.units.infantry} C:${k.units.cavalry} A:${k.units.archer}</p>`;});
document.getElementById("aiStatus").innerHTML=statusHTML;
}

// ===== ARMY MANAGEMENT =====
function recruit(type){
let n=0;
if(type==='infantry') n=Number(document.getElementById('recInf').value);
else if(type==='cavalry') n=Number(document.getElementById('recCav').value);
else if(type==='archer') n=Number(document.getElementById('recArc').value);
if(n>0 && game.pop>=n && game.food>=n/2){game.pop-=n; game.food-=n/2; game.units[type]+=n;}
render();
}

// ===== PRODUCTION =====
function setProd(type){if(type==='farm') game.production.farm=Number(document.getElementById('farmNum').value);
if(type==='factory') game.production.factory=Number(document.getElementById('facNum').value); render();}

// ===== TRADE =====
function sellFood(){if(game.food>=100){game.food-=100;game.gold+=80;render();}}
function buyFood(){if(game.gold>=90){game.gold-=90;game.food+=100;render();}}

// ===== COUNCIL / LAWS =====
function applyTax(){let t=Number(document.getElementById("tax").value);game.gold+=t*10;game.stab-=t/2;render();}
function law(l){if(l=='tax'){game.gold+=200;game.stab-=10;}
if(l=='growth'){game.pop+=200;game.gold-=50;}
if(l=='military'){game.units.infantry+=50;game.units.cavalry+=20;game.units.archer+=30;game.stab-=5;}
if(l=='trade'){game.gold+=100;game.food-=20;} render();}

// ===== ATTACK =====
function updateTargets(){let sel=document.getElementById("targetSelect"); sel.innerHTML=""; kingdoms.forEach((k,i)=>{if(!k.owner) sel.innerHTML+=`<option value="${i}">${k.name}</option>`});}

function attack(){
let idx=Number(document.getElementById("targetSelect").value);
let target=kingdoms[idx];
let atkInf=Number(document.getElementById("atkInf").value);
let atkCav=Number(document.getElementById("atkCav").value);
let atkArc=Number(document.getElementById("atkArc").value);

if(atkInf>game.units.infantry || atkCav>game.units.cavalry || atkArc>game.units.archer){alert("Not enough units!"); return;}
game.units.infantry-=atkInf; game.units.cavalry-=atkCav; game.units.archer-=atkArc;

let atkPower=atkInf + atkCav*2 + atkArc;
let defPower=target.units.infantry + target.units.cavalry*2 + target.units.archer;
if(atkPower>defPower){target.owner=true;alert(`You conquered ${target.name}!`);}
else{alert(`Attack failed on ${target.name}`);}

updateTargets();
render();
}

// ===== TURN SYSTEM =====
function endTurn(){
game.year++;
game.food+=game.production.farm*50;
game.gold+=game.production.factory*20;
aiTurn();
render();
}

// ===== AI TURN =====
function aiTurn(){
kingdoms.forEach(k=>{
if(!k.owner){
for(let u in k.units){k.units[u]+=Math.floor(Math.random()*5);} // army growth
// AI attacks other AI or player
let possibleTargets=kingdoms.filter(t=>t!==k && !t.owner?true:t.owner!==true); // attack player or other AI
if(possibleTargets.length>0 && Math.random()<0.4){
let target=possibleTargets[Math.floor(Math.random()*possibleTargets.length)];
let atkInf=Math.min(k.units.infantry, Math.floor(Math.random()*50));
let atkCav=Math.min(k.units.cavalry, Math.floor(Math.random()*25));
let atkArc=Math.min(k.units.archer, Math.floor(Math.random()*25));

k.units.infantry-=atkInf; k.units.cavalry-=atkCav; k.units.archer-=atkArc;

let atkPower=atkInf + atkCav*2 + atkArc;
let defPower=target.units.infantry + target.units.cavalry*2 + target.units.archer;
if(atkPower>defPower){target.owner=false; if(target===player){alert(`${k.name} conquered your kingdom!`);} else {target.owner=false;} target.units={infantry:Math.floor(atkInf/2),cavalry:Math.floor(atkCav/2),archer:Math.floor(atkArc/2)};}
}
}
});
updateTargets();
}

// ===== SAVE / LOAD =====
function saveGame(){localStorage.setItem("MedievalSimAIWar",JSON.stringify({game,kingdoms})); alert("Game Saved");}
function loadGame(){let d=localStorage.getItem("MedievalSimAIWar"); if(d){let dat=JSON.parse(d);game=dat.game; kingdoms=dat.kingdoms; render(); alert("Game Loaded");}}

// ===== INIT =====
initKingdoms();
let sel=document.getElementById("kingdomSelect");
kingdoms.forEach((k,i)=>{sel.innerHTML+=`<option value="${i}">${k.name}</option>`});
</script>

</body>
</html>

