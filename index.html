<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AOC++ FINAL PRO++ UPGRADE</title>
<style>
body{margin:0;font-family:Arial;background:#020617;color:#e5e7eb}
.top{display:flex;flex-wrap:wrap;gap:6px;padding:8px;background:#020617;font-size:13px}
.top span{background:#1e293b;padding:4px 6px;border-radius:6px}
.panel{display:none;padding:10px;overflow-y:auto;max-height:70vh}
.active{display:block}
button,input{padding:8px;border-radius:6px;border:none;margin:4px;cursor:pointer}
button{background:#2563eb;color:#fff}
input{width:80px}

.map{position:relative;height:65vh;background:linear-gradient(#0f172a,#020617);border-top:2px solid #1e293b;}
.k{position:absolute;padding:4px 6px;font-size:11px;border-radius:6px;color:#fff;text-align:center;font-weight:bold}
.enemy{background:#dc2626;}
.owned{background:#16a34a;}

.menu{position:fixed;bottom:0;width:100%;background:#020617;display:flex;flex-wrap:wrap;justify-content:space-around}
.box{background:#1e293b;padding:8px;border-radius:8px;margin:6px 0}
</style>
</head>

<body>
<div class="top">
<span>ğŸ’° <b id="gold"></b></span>
<span>ğŸ <b id="food"></b></span>
<span>ğŸ‘¥ <b id="pop"></b></span>
<span>âš” <b id="army"></b></span>
<span>ğŸ˜Š <b id="stab"></b>%</span>
<span>ğŸ“… <b id="year"></b></span>
</div>

<div id="home" class="panel active">
<h2>ğŸŒ Medieval World Simulator</h2>
<button onclick="openP('mapP')">Open Map</button>
<button onclick="openP('armyP')">Army</button>
<button onclick="openP('trade')">Trade</button>
<button onclick="openP('council')">Council</button>
<button onclick="saveGame()">ğŸ’¾ Save Game</button>
<button onclick="loadGame()">ğŸ“‚ Load Game</button>
</div>

<div id="mapP" class="panel"><div class="map" id="map"></div></div>
<div id="info" class="panel"></div>

<div id="armyP" class="panel">
<h3>âš” Army & Units</h3>
<div class="box">
Recruit Soldiers: <input type="number" id="recNum" value="100">
<button onclick="recruit()">Recruit</button>
</div>
<div class="box">
<h4>ğŸ›¡ Units</h4>
<button onclick="addUnit('Infantry')">ğŸ›¡ Infantry</button>
<button onclick="addUnit('Cavalry')">ğŸ Cavalry</button>
<button onclick="addUnit('Archer')">ğŸ¹ Archer</button>
<p id="units">No units</p>
</div>
<div class="box">
<button onclick="hireGeneral()">ğŸ– Hire General (150 Gold)</button>
<p>Generals: <b id="gen"></b></p>
</div>
</div>

<div id="trade" class="panel">
<h3>ğŸ¤ Trade</h3>
<button onclick="sellFood()">Sell 100 Food â†’ +80 Gold</button>
<button onclick="buyFood()">Buy 100 Food â†’ -90 Gold</button>
</div>

<div id="council" class="panel">
<h3>ğŸ› Council & Laws</h3>
<div class="box">
Tax Rate: <input type="number" id="tax" value="10"> % <button onclick="applyTax()">Apply</button>
</div>
<div class="box">
<button onclick="law('tax')">High Tax Law</button>
<button onclick="law('growth')">Population Growth Law</button>
<button onclick="law('military')">Military Focus Law</button>
<button onclick="law('trade')">Trade Focus Law</button>
</div>
</div>

<div class="menu">
<button onclick="openP('home')">Home</button>
<button onclick="openP('mapP')">Map</button>
<button onclick="endTurn()">End Turn</button>
</div>

<script>
// ====== GAME STATE ======
let game={gold:600,food:500,pop:1600,stab:70,year:1400,units:[],generals:0,army:0};

// ====== KINGDOMS ======
let kingdoms=[
{name:"England",x:10,y:20,army:{infantry:200,cavalry:50,archer:50},population:1000,owner:true,production:{farm:2,factory:1}},
{name:"France",x:25,y:30,army:{infantry:250,cavalry:100,archer:100},population:1200,owner:false,production:{farm:3,factory:1}},
{name:"HRE",x:40,y:25,army:{infantry:300,cavalry:100,archer:100},population:1400,owner:false,production:{farm:2,factory:2}},
{name:"Castile",x:15,y:45,army:{infantry:150,cavalry:100,archer:100},population:900,owner:false,production:{farm:2,factory:1}}
];

// ====== PANEL MANAGEMENT ======
function openP(id){document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));document.getElementById(id).classList.add("active");render();}

// ====== RENDER ======
function render(){
game.army=0;
kingdoms.forEach(k=>{if(k.owner){for(let u in k.army){game.army+=k.army[u];}}});
document.getElementById("gold").innerText=game.gold;
document.getElementById("food").innerText=game.food;
document.getElementById("pop").innerText=game.pop;
document.getElementById("army").innerText=game.army;
document.getElementById("stab").innerText=game.stab;
document.getElementById("year").innerText=game.year;
document.getElementById("gen").innerText=game.generals;
document.getElementById("units").innerText=game.units.join(", ")||"No units";
renderMap();
}

// ====== MAP ======
function openMap(){openP('mapP');renderMap();}
function renderMap(){
const map=document.getElementById("map"); map.innerHTML="";
kingdoms.forEach((k,i)=>{
let d=document.createElement("div");
d.className="k "+(k.owner?"owned":"enemy");
d.style.left=k.x+"%"; d.style.top=k.y+"%";
d.innerText=k.name;
d.onclick=()=>infoK(i); map.appendChild(d);
});
}

// ====== INFO ======
function infoK(i){
let k=kingdoms[i]; openP("info");
info.innerHTML=`
<h3>${k.name}</h3>
Population: ${k.population}<br>
Status: ${k.owner?"Owned":"Enemy"}<br>
Army:<br>
&nbsp;ğŸ›¡ Infantry: ${k.army.infantry}<br>
&nbsp;ğŸ Cavalry: ${k.army.cavalry}<br>
&nbsp;ğŸ¹ Archer: ${k.army.archer}<br>
Generals: ${k.owner?game.generals:0}<br>
Production:<br>
&nbsp;ğŸŒ¾ Farm: ${k.production.farm} per turn<br>
&nbsp;ğŸ­ Factory: ${k.production.factory} per turn<br>
${!k.owner?`<button onclick="attack(${i})">Attack</button>`:""}
<button onclick="openMap()">Back</button>`;
}

// ====== ATTACK ======
function attack(i){
let enemy=kingdoms[i];
let power=game.army + game.generals*100 + game.units.length*50;
let enemyPower=enemy.army.infantry + enemy.army.cavalry*2 + enemy.army.archer;
if(power>enemyPower){enemy.owner=true;game.gold+=120;game.stab+=3;}
else{let lost=Math.floor(enemyPower/5);game.army-=lost;game.stab-=5;}
aiTurn(); openMap(); render();
}

// ====== ARMY / UNITS ======
function recruit(){let n=Number(document.getElementById("recNum").value);if(n>0 && game.pop>=n && game.food>=n/2){game.pop-=n;game.food-=n/2;kingdoms.forEach(k=>{if(k.owner)k.army.infantry+=n;});}render();}
function addUnit(t){if(game.army>=100){game.army-=100;game.units.push(t);render();}} 
function hireGeneral(){if(game.gold>=150){game.gold-=150;game.generals++;render();}}

// ====== TRADE ======
function sellFood(){if(game.food>=100){game.food-=100;game.gold+=80;render();}}
function buyFood(){if(game.gold>=90){game.gold-=90;game.food+=100;render();}}

// ====== COUNCIL ======
function applyTax(){let t=Number(document.getElementById("tax").value);game.gold+=t*10;game.stab-=t/2;render();}
function law(l){if(l=="tax"){game.gold+=200;game.stab-=10;} if(l=="growth"){game.pop+=200;game.gold-=50;} if(l=="military"){kingdoms.forEach(k=>{if(k.owner)k.army.infantry+=50;});game.stab-=5;} if(l=="trade"){game.gold+=100;game.food-=20;} render();}

// ====== END TURN ======
function endTurn(){
game.year++; 
kingdoms.forEach(k=>{if(k.owner){
game.food+=k.production.farm*50;
game.gold+=k.production.factory*20;
}}); 
aiTurn(); randomEvents(); render();
}

// ====== AI & EVENTS ======
function aiTurn(){kingdoms.forEach(k=>{if(!k.owner){for(let u in k.army){k.army[u]+=5;} if(Math.random()<0.3){let target=kingdoms[Math.floor(Math.random()*kingdoms.length)]; if(target.owner && target.name!=k.name)attackKingdomAI(k,target);}}});}
function attackKingdomAI(ai,target){let aiPower=ai.army.infantry+ai.army.cavalry*2+ai.army.archer;if(aiPower>target.army.infantry+target.army.cavalry*2+target.army.archer){target.owner=false;ai.army.infantry+=50;}}

function randomEvents(){kingdoms.forEach(k=>{if(k.owner && Math.random()*(100-game.stab)>90){let lost=Math.floor(k.army.infantry*0.2);k.army.infantry-=lost;game.army-=lost;alert(`Revolt in ${k.name}! Army lost: ${lost}`);}});if(Math.random()<0.03){let loss=Math.floor(game.pop*0.1);game.pop-=loss;alert("Plague! Population lost: "+loss);}}
  
// ====== SAVE / LOAD ======
function saveGame(){localStorage.setItem("AOCFinalProPlusUpgrade",JSON.stringify({game,kingdoms}));alert("Game Saved");}
function loadGame(){let d=localStorage.getItem("AOCFinalProPlusUpgrade"); if(d){let dat=JSON.parse(d);game=dat.game; kingdoms=dat.kingdoms; render(); alert("Game Loaded");}}

// INITIAL RENDER
render();
</script>

</body>
</html>
